{% load url from future %}
<!DOCTYPE html>

  <script>

(function ($) {
  // custom css expression for a case-insensitive contains()
  jQuery.expr[':'].Contains = function(a,i,m){
      return (a.textContent || a.innerText || "").toUpperCase().indexOf(m[3].toUpperCase())>=0;
  };


  function listFilter(header, list) { // header is any element, list is an unordered list
    // create and add the filter form to the header
    var form = $("<form>").attr({"class":"filterform","action":"#"}),
        input = $("<input>").attr({"class":"filterinput","type":"text","placeholder":"Search..."});
    $(form).append(input).appendTo(header);

    $(input).change( function () {
        var filter = $(this).val();
        if(filter) {
          // this finds all links in a list that contain the input,
          // and hide the ones not containing the input while showing the ones that do
          var items = $(list).find("li");
          var matches = items.find("span:Contains(" + filter + ")").parent();
          var misses = items.find("span").parent().not(matches);
          misses.slideUp();
          matches.slideDown();
        } else {
          $(list).find("li").slideDown();
        }
        return false;
      })
    .keyup( function () {
        // fire the above change event after every letter
        $(this).change();
    });
  }


  //ondomready
  $(function () {
    listFilter($("#header"), $("#not-sortable"));
  });
}(jQuery));

  </script>
  <title>
    {% if title %}
    {{ title }}
    {% else %}
    Cannen Collaborative Music Player
    {% endif %}
  </title>
  </head>

  <body>
    <div class="container">

    <div class="span8" id="localLibrary">
	  <ul class="nav nav-list">
  	    <li id="header" class="nav-header">
		  Local Library
	    </li>
	  </ul>
      {% if library %}
      <ul id="not-sortable" class="nav nav-list">
        {% for song in library %}
        <li class="context-container" id="library-{{ song.model.id }}">
          <span class="context">
            <a href="{% url 'cannen.views.play' song.model.file.url %}" class="asynclink"><i class="icon-play"></i></a>
          </span>      
	      <span class="title">{{ song.title }}</span>
          {% if song.artist %}
          <span class="subtitle">by {{ song.artist }}</span>
          {% endif %}
		  &nbsp;<span class="label">{{song.model.owner}}</span>
        </li>
	    {% endfor %}  
      </ul>
	  {% else %}
	  It seems nobody has uploaded any items to play. 
	  {% endif %} 
	</div>
	
  </div>
  </body>

